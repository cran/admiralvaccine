<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Creating ADFACE</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Creating ADFACE</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This article describes about creating <code>ADFACE</code> ADaM dataset which is part of Vaccine - Reactogenicity based on the Center for Biologics Evaluation and Research (CBER) guidelines.</p>
<p>See the below links for more information:</p>
<p><a href="https://www.fda.gov/media/112581/download">Center for Biologics Evaluation and Research (CBER) Guidelines</a></p>
<p><a href="https://www.cdisc.org/standards/therapeutic-areas/vaccines/vaccines-therapeutic-area-user-guide-v11/html">Therapeutic Area Data Standards User Guide for Vaccines (TAUG-Vax)</a></p>
<p>Examples are currently tested using <code>ADSL</code> (ADaM) and <code>face</code>, <code>vs</code>, <code>ex</code> (SDTM) inputs.</p>
<p><strong>Note</strong>: <em>All examples assume CDISC SDTM and/or ADaM format as input unless otherwise specified.</em></p>
</div>
<div id="programming-workflow" class="section level1">
<h1>Programming Workflow</h1>
<ul>
<li><a href="#readdata">Read in Data</a></li>
<li><a href="#input">Pre-processing of Input Dataset</a></li>
<li><a href="#merge">Merge <code>FACE</code> with <code>EX</code></a></li>
<li><a href="#adsl">Merge Required <code>ADSL</code> Variables Needed for Analysis</a></li>
<li><a href="#fever">Derive Fever Records from <code>VS</code> Domain</a></li>
<li><a href="#datetime">Derive/Impute Numeric Date/Time and Analysis Day (<code>ADT</code>, <code>ADTM</code>, <code>ADY</code>, <code>ADTF</code>, <code>ATMF</code>)</a></li>
<li><a href="#periodvars">Derive Period Variables (e.g. <code>APxxSDT</code>, <code>APxxEDT</code>, …)</a></li>
<li><a href="#mapping">Derive Direct Mapping Variables</a></li>
<li><a href="#sev">Derive Severity Records for Administration Site Events</a></li>
<li><a href="#max">Derive Maximum Records</a></li>
<li><a href="#paramcd">Assign <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code>, <code>PARCAT1</code></a></li>
<li><a href="#maxflag">Derive Maximum Severity Flag</a></li>
<li><a href="#eventflag">Derive Event Occurrence Flag</a></li>
<li><a href="#post">Post-processing of the Dataset</a></li>
<li><a href="#adsl_vars">Add ADSL Variables</a></li>
</ul>
<div id="readdata" class="section level2">
<h2>Read in Data</h2>
<p>To start, all data frames needed for the creation of <code>ADFACE</code> should be read into the environment. Some of the data frames needed are <code>VS</code>,<code>EX</code> and <code>FACE</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(admiral)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(admiralvaccine)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">data</span>(<span class="st">&quot;vx_face&quot;</span>)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">data</span>(<span class="st">&quot;vx_suppface&quot;</span>)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">data</span>(<span class="st">&quot;vx_ex&quot;</span>)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">data</span>(<span class="st">&quot;vx_suppex&quot;</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">data</span>(<span class="st">&quot;vx_vs&quot;</span>)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">data</span>(<span class="st">&quot;vx_adsl&quot;</span>)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">face &lt;-<span class="st"> </span><span class="kw">convert_blanks_to_na</span>(vx_face)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">ex &lt;-<span class="st"> </span><span class="kw">convert_blanks_to_na</span>(vx_ex)</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">vs &lt;-<span class="st"> </span><span class="kw">convert_blanks_to_na</span>(vx_vs)</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">suppface &lt;-<span class="st"> </span><span class="kw">convert_blanks_to_na</span>(vx_suppface)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">suppex &lt;-<span class="st"> </span><span class="kw">convert_blanks_to_na</span>(vx_suppex)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">adsl &lt;-<span class="st"> </span><span class="kw">convert_blanks_to_na</span>(vx_adsl)</a></code></pre></div>
</div>
<div id="input" class="section level2">
<h2>Pre-processing of Input Dataset</h2>
<p>This step involves company-specific pre-processing of required input dataset for further analysis. In this step, we will filter records that has only reactogenicity events.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">face &lt;-<span class="st"> </span>face <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(FACAT <span class="op">==</span><span class="st"> &quot;REACTOGENICITY&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;ADMIN|SYS&quot;</span>, FASCAT)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FAOBJ =</span> <span class="kw">str_to_upper</span>(FAOBJ))</a></code></pre></div>
<table>
<colgroup>
<col width="8%"></col>
<col width="20%"></col>
<col width="8%"></col>
<col width="13%"></col>
<col width="18%"></col>
<col width="12%"></col>
<col width="18%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="left">FATESTCD</th>
<th align="left">FACAT</th>
<th align="left">FASCAT</th>
<th align="left">FATPTREF</th>
<th align="left">FADTC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">SYSTEMIC</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-03T18:00:23</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">SYSTEMIC</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-04T18:01:09</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">SYSTEMIC</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-05T19:04:07</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">SYSTEMIC</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-06T18:00:33</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">SYSTEMIC</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-07T18:01:25</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">SYSTEMIC</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-08T18:00:26</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">SYSTEMIC</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-09T18:08:04</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-03T18:00:23</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">OCCUR</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-04T18:01:09</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">SEV</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
<td align="left">VACCINATION 1</td>
<td align="left">2021-11-04T18:01:09</td>
</tr>
</tbody>
</table>
</div>
<div id="merge" class="section level2">
<h2>Merge <code>FACE</code> with <code>EX</code></h2>
<p>In this step, we will merge <code>face</code> with <code>ex</code> domain and add required variables from <code>ex</code> domain to the input dataset. If subjects have multiple vaccination at same visit then this function will not merge input dataset with <code>ex</code> dataset and throws a warning.</p>
<p>The function <code>derive_vars_merged_vaccine()</code> is used to merge <code>face</code> with <code>ex</code> domain.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">adface &lt;-<span class="st"> </span><span class="kw">derive_vars_merged_vaccine</span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">dataset =</span> face,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">dataset_ex =</span> ex,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="dt">dataset_supp =</span> suppface,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="dt">dataset_suppex =</span> suppex,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  <span class="dt">by_vars_sys =</span> <span class="kw">exprs</span>(USUBJID, <span class="dt">FATPTREF =</span> EXLNKGRP),</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  <span class="dt">by_vars_adms =</span> <span class="kw">exprs</span>(USUBJID, <span class="dt">FATPTREF =</span> EXLNKGRP, <span class="dt">FALOC =</span> EXLOC, <span class="dt">FALAT =</span> EXLAT),</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  <span class="dt">ex_vars =</span> <span class="kw">exprs</span>(EXTRT, EXDOSE, EXSEQ, EXSTDTC, EXENDTC, VISIT, VISITNUM)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="left">FATESTCD</th>
<th align="left">FATPTREF</th>
<th align="left">EXTRT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">OCCUR</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">OCCUR</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">SEV</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">OCCUR</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">SEV</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">OCCUR</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">SEV</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">OCCUR</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">SEV</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">OCCUR</td>
<td align="left">VACCINATION 1</td>
<td align="left">VACCINE A</td>
</tr>
</tbody>
</table>
<p>This call would return the input dataset with columns from <code>ex_vars</code> added if the subjects does not have multiple vaccination at same visit.</p>
<p>Though the function will throw warning if subjects have multiple vaccination at same visit, this call would return the input dataset merging it with supplementary dataset.</p>
</div>
<div id="adsl" class="section level2">
<h2>Merge Required <code>ADSL</code> Variables Needed for Analysis</h2>
<p>At this step, it may be useful to join <code>ADSL</code> to your <code>face</code> domain. Only the <code>ADSL</code> variables used for derivations are selected at this step. The rest of the relevant <code>ADSL</code> variables would be added later.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">adsl_vars &lt;-<span class="st"> </span><span class="kw">exprs</span>(RFSTDTC, RFENDTC)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">adface &lt;-<span class="st"> </span><span class="kw">derive_vars_merged</span>(</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  face,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="dt">dataset_add =</span> adsl,</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  <span class="dt">new_vars =</span> adsl_vars,</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  <span class="dt">by_vars =</span> <span class="kw">exprs</span>(STUDYID, USUBJID)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">RFSTDTC</th>
<th align="left">RFENDTC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03T10:50:00</td>
<td align="left">2022-04-27</td>
</tr>
</tbody>
</table>
<p>This call would return the input dataset with columns <code>RFSTDTC</code>, <code>RFENDTC</code> added.</p>
</div>
<div id="fever" class="section level2">
<h2>Derive Fever Records from <code>VS</code> Domain</h2>
<p>In this step, we will merge fever records from the <code>VS</code> domain with the input dataset if the fever records does not present in the input dataset.</p>
<p>The function <code>derive_fever_records()</code> is used to merge fever records. These records will also be used in maximum temperature calculation.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">adface &lt;-<span class="st"> </span><span class="kw">derive_fever_records</span>(</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="dt">dataset_source =</span> vs,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="dt">filter_source =</span> VSCAT <span class="op">==</span><span class="st"> &quot;REACTOGENICITY&quot;</span> <span class="op">&amp;</span><span class="st"> </span>VSTESTCD <span class="op">==</span><span class="st"> &quot;TEMP&quot;</span>,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="dt">faobj =</span> <span class="st">&quot;FEVER&quot;</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="left">FATESTCD</th>
<th align="left">FAORRES</th>
<th align="right">VSSTRESN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">N</td>
<td align="right">36.61</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">N</td>
<td align="right">37.28</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">N</td>
<td align="right">36.28</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">N</td>
<td align="right">36.83</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">N</td>
<td align="right">36.56</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">N</td>
<td align="right">37.28</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">N</td>
<td align="right">36.72</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">FEVER</td>
<td align="left">OCCUR</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>This call returns the input dataset with <code>FEVER</code> records added if the input dataset does not have <code>FEVER</code> records. If the input dataset has <code>FEVER</code> records, the output dataset will be same as the input dataset.</p>
</div>
<div id="datetime" class="section level2">
<h2>Derive/Impute Numeric Date/Time and Analysis Day (<code>ADT</code>, <code>ADTM</code>, <code>ADTF</code>, <code>ATMF</code>, <code>ADY</code>)</h2>
<p>The function <code>derive_vars_dt()</code> can be used to derive <code>ADT</code>. This function allows the user to impute the date as well.</p>
<p>Similarly, <code>ADTM</code> can be created using the function <code>derive_vars_dtm()</code>. Imputation can be done on both the date and time components of <code>ADTM</code>.</p>
<p>Example calls:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">adface &lt;-<span class="st"> </span>adface <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">derive_vars_dt</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="dt">new_vars_prefix =</span> <span class="st">&quot;A&quot;</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="dt">dtc =</span> FADTC</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw">derive_vars_dtm</span>(</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">    <span class="dt">new_vars_prefix =</span> <span class="st">&quot;A&quot;</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    <span class="dt">dtc =</span> FADTC,</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">    <span class="dt">highest_imputation =</span> <span class="st">&quot;n&quot;</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  )</a></code></pre></div>
<p>Once <code>ADT</code> is derived, the function <code>derive_vars_dy()</code> can be used to derive <code>ADY</code>. This example assumes both <code>ADT</code> and <code>RFSTDTC</code> exist on the data frame.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">adface &lt;-<span class="st"> </span>adface <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RFSTDTC =</span> <span class="kw">as.Date</span>(RFSTDTC)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw">derive_vars_dy</span>(<span class="dt">reference_date =</span> RFSTDTC, <span class="dt">source_vars =</span> <span class="kw">exprs</span>(ADT))</a></code></pre></div>
<table>
<colgroup>
<col width="11%"></col>
<col width="17%"></col>
<col width="28%"></col>
<col width="13%"></col>
<col width="24%"></col>
<col width="4%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FATPTREF</th>
<th align="left">FAOBJ</th>
<th align="left">ADT</th>
<th align="left">ADTM</th>
<th align="right">ADY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">CHILLS</td>
<td align="left">2021-11-03</td>
<td align="left">2021-11-03 18:00:23</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">CHILLS</td>
<td align="left">2021-11-04</td>
<td align="left">2021-11-04 18:01:09</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">CHILLS</td>
<td align="left">2021-11-05</td>
<td align="left">2021-11-05 19:04:07</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">CHILLS</td>
<td align="left">2021-11-06</td>
<td align="left">2021-11-06 18:00:33</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">CHILLS</td>
<td align="left">2021-11-07</td>
<td align="left">2021-11-07 18:01:25</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">CHILLS</td>
<td align="left">2021-11-08</td>
<td align="left">2021-11-08 18:00:26</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">CHILLS</td>
<td align="left">2021-11-09</td>
<td align="left">2021-11-09 18:08:04</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">2021-11-03</td>
<td align="left">2021-11-03 18:00:23</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">2021-11-04</td>
<td align="left">2021-11-04 18:01:09</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">VACCINATION 1</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">2021-11-04</td>
<td align="left">2021-11-04 18:01:09</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div id="periodvars" class="section level2">
<h2>Derive Period Variables (e.g. <code>APxxSDT</code>, <code>APxxEDT</code>, …)</h2>
<p>The <code>{admiral}</code> core package has separate functions to handle period variables since these variables are study specific.</p>
<p>See the <a href="https://pharmaverse.github.io/admiral/cran-release/articles/visits_periods.html">“Visit and Period Variables” vignette</a> for more information.</p>
<p>If the variables are not derived based on a period reference dataset, they may be derived at a later point of the flow. For example, phases like “Treatment Phase” and “Follow up” could be derived based on treatment start and end date.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">period_ref &lt;-<span class="st"> </span><span class="kw">create_period_dataset</span>(</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="dt">dataset =</span> adsl,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="dt">new_vars =</span> <span class="kw">exprs</span>(</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="dt">APERSDT =</span> APxxSDT, <span class="dt">APEREDT =</span> APxxEDT, <span class="dt">TRTA =</span> TRTxxA,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="dt">TRTP =</span> TRTxxP</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">adface &lt;-<span class="st"> </span><span class="kw">derive_vars_joined</span>(</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">  adface,</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">  <span class="dt">dataset_add =</span> period_ref,</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">  <span class="dt">by_vars =</span> <span class="kw">exprs</span>(STUDYID, USUBJID),</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  <span class="dt">filter_join =</span> ADT <span class="op">&gt;=</span><span class="st"> </span>APERSDT <span class="op">&amp;</span><span class="st"> </span>ADT <span class="op">&lt;=</span><span class="st"> </span>APEREDT</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">APERSDT</th>
<th align="left">APEREDT</th>
<th align="left">TRTA</th>
<th align="left">TRTP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-29</td>
<td align="left">VACCINE A</td>
<td align="left">VACCINE A</td>
</tr>
</tbody>
</table>
</div>
<div id="mapping" class="section level2">
<h2>Derive Direct Mapping Variables</h2>
<p>In this step,we will create the user defined function to assign <code>AVAL</code> values from <code>AVALC</code> which will be used in further steps.</p>
<p>The user defined functions would look like the following:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">sev_to_numeric &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    x <span class="op">==</span><span class="st"> &quot;NONE&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    x <span class="op">==</span><span class="st"> &quot;MILD&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    x <span class="op">==</span><span class="st"> &quot;MODERATE&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    x <span class="op">==</span><span class="st"> &quot;SEVERE&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">}</a></code></pre></div>
<p>The mapping of these variables is left to the User. An example mapping may be:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">adface &lt;-<span class="st"> </span>adface <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    <span class="dt">AVALC =</span> <span class="kw">as.character</span>(FASTRESC),</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    <span class="dt">AVAL =</span> <span class="kw">suppressWarnings</span>(<span class="kw">as.numeric</span>(FASTRESN)),</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    <span class="dt">AVAL =</span> <span class="kw">sev_to_numeric</span>(AVALC, AVAL),</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    <span class="dt">ATPTREF =</span> FATPTREF,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    <span class="dt">ATPT =</span> FATPT,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">    <span class="dt">ATPTN =</span> FATPTNUM</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">  )</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
<th align="left">ATPTREF</th>
<th align="right">ATPTN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="right">NA</td>
<td align="left">N</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="right">NA</td>
<td align="left">N</td>
<td align="left">VACCINATION 1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="right">NA</td>
<td align="left">N</td>
<td align="left">VACCINATION 1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="right">NA</td>
<td align="left">N</td>
<td align="left">VACCINATION 1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="right">NA</td>
<td align="left">N</td>
<td align="left">VACCINATION 1</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="right">NA</td>
<td align="left">N</td>
<td align="left">VACCINATION 1</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">CHILLS</td>
<td align="right">NA</td>
<td align="left">N</td>
<td align="left">VACCINATION 1</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="right">NA</td>
<td align="left">N</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="right">NA</td>
<td align="left">Y</td>
<td align="left">VACCINATION 1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
<td align="left">VACCINATION 1</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div id="sev" class="section level2">
<h2>Derive Severity Records for Administration Site Events</h2>
<p>The function <code>derive_diam_to_sev_records()</code> is used to derive the severity records from the diameter records for an event.</p>
<p>The severity records created will be useful for calculating the maximum severity.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">adface &lt;-<span class="st"> </span><span class="kw">derive_diam_to_sev_records</span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">diam_code =</span> <span class="st">&quot;DIAMETER&quot;</span>,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="dt">faobj_values =</span> <span class="kw">c</span>(<span class="st">&quot;REDNESS&quot;</span>, <span class="st">&quot;SWELLING&quot;</span>),</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="dt">testcd_sev =</span> <span class="st">&quot;SEV&quot;</span>,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  <span class="dt">test_sev =</span> <span class="st">&quot;Severity/Intensity&quot;</span>,</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  <span class="dt">none =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  <span class="dt">mild =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  <span class="dt">mod =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">  <span class="dt">sev =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="left">ATPTREF</th>
<th align="left">FATESTCD</th>
<th align="left">FATEST</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">0</td>
<td align="left">NONE</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">0</td>
<td align="left">NONE</td>
</tr>
<tr class="odd">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="even">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 2</td>
<td align="left">SEV</td>
<td align="left">Severity/Intensity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
</tbody>
</table>
<p>This call returns the input dataset with severity records derived from the diameter records for an event.</p>
<p>By default, we will populate <code>SEV</code> and <code>Severity/Intensity</code> as the <code>FATESTCD</code> and <code>FATEST</code> for the newly added records. The function allows the user to change the <code>FATESTCD</code> and <code>FATEST</code> as well.</p>
</div>
<div id="max" class="section level2">
<h2>Derive Maximum Records</h2>
<p>In this step, we will derive maximum records for severity, diameter, temperature using the function <code>derive_extreme_records()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">adface &lt;-<span class="st"> </span><span class="kw">derive_extreme_records</span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">filter_add =</span> FATESTCD <span class="op">==</span><span class="st"> &quot;SEV&quot;</span>,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">by_vars =</span> <span class="kw">exprs</span>(USUBJID, FAOBJ, ATPTREF),</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  <span class="dt">order =</span> <span class="kw">exprs</span>(AVAL),</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  <span class="dt">check_type =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  <span class="dt">mode =</span> <span class="st">&quot;last&quot;</span>,</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  <span class="dt">set_values_to =</span> <span class="kw">exprs</span>(</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">    <span class="dt">FATEST =</span> <span class="st">&quot;Maximum Severity&quot;</span>,</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">    <span class="dt">FATESTCD =</span> <span class="st">&quot;MAXSEV&quot;</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb12-13" data-line-number="13"></a>
<a class="sourceLine" id="cb12-14" data-line-number="14">adface &lt;-<span class="st"> </span><span class="kw">derive_extreme_records</span>(</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">  <span class="dt">filter_add =</span> FAOBJ <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;REDNESS&quot;</span>, <span class="st">&quot;SWELLING&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>FATESTCD <span class="op">==</span><span class="st"> &quot;DIAMETER&quot;</span>,</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">  <span class="dt">by_vars =</span> <span class="kw">exprs</span>(USUBJID, FAOBJ, FALNKGRP),</a>
<a class="sourceLine" id="cb12-18" data-line-number="18">  <span class="dt">order =</span> <span class="kw">exprs</span>(AVAL),</a>
<a class="sourceLine" id="cb12-19" data-line-number="19">  <span class="dt">check_type =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb12-20" data-line-number="20">  <span class="dt">mode =</span> <span class="st">&quot;last&quot;</span>,</a>
<a class="sourceLine" id="cb12-21" data-line-number="21">  <span class="dt">set_values_to =</span> <span class="kw">exprs</span>(</a>
<a class="sourceLine" id="cb12-22" data-line-number="22">    <span class="dt">FATEST =</span> <span class="st">&quot;Maximum Diameter&quot;</span>,</a>
<a class="sourceLine" id="cb12-23" data-line-number="23">    <span class="dt">FATESTCD =</span> <span class="st">&quot;MAXDIAM&quot;</span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24">  )</a>
<a class="sourceLine" id="cb12-25" data-line-number="25">)</a>
<a class="sourceLine" id="cb12-26" data-line-number="26"></a>
<a class="sourceLine" id="cb12-27" data-line-number="27">adface &lt;-<span class="st"> </span><span class="kw">derive_extreme_records</span>(</a>
<a class="sourceLine" id="cb12-28" data-line-number="28">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb12-29" data-line-number="29">  <span class="dt">filter_add =</span> FAOBJ <span class="op">==</span><span class="st"> &quot;FEVER&quot;</span>,</a>
<a class="sourceLine" id="cb12-30" data-line-number="30">  <span class="dt">by_vars =</span> <span class="kw">exprs</span>(USUBJID, FAOBJ, ATPTREF),</a>
<a class="sourceLine" id="cb12-31" data-line-number="31">  <span class="dt">order =</span> <span class="kw">exprs</span>(VSSTRESN),</a>
<a class="sourceLine" id="cb12-32" data-line-number="32">  <span class="dt">check_type =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb12-33" data-line-number="33">  <span class="dt">mode =</span> <span class="st">&quot;last&quot;</span>,</a>
<a class="sourceLine" id="cb12-34" data-line-number="34">  <span class="dt">set_values_to =</span> <span class="kw">exprs</span>(</a>
<a class="sourceLine" id="cb12-35" data-line-number="35">    <span class="dt">FATEST =</span> <span class="st">&quot;Maximum Temperature&quot;</span>,</a>
<a class="sourceLine" id="cb12-36" data-line-number="36">    <span class="dt">FATESTCD =</span> <span class="st">&quot;MAXTEMP&quot;</span></a>
<a class="sourceLine" id="cb12-37" data-line-number="37">  )</a>
<a class="sourceLine" id="cb12-38" data-line-number="38">)</a></code></pre></div>
<table>
<colgroup>
<col width="9%"></col>
<col width="30%"></col>
<col width="15%"></col>
<col width="9%"></col>
<col width="18%"></col>
<col width="5%"></col>
<col width="9%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="left">ATPTREF</th>
<th align="left">FATESTCD</th>
<th align="left">FATEST</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">FATIGUE</td>
<td align="left">VACCINATION 1</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">NEW OR WORSENED JOINT PAIN</td>
<td align="left">VACCINATION 1</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">NEW OR WORSENED MUSCLE PAIN</td>
<td align="left">VACCINATION 1</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">VACCINATION 1</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
</tr>
<tr class="odd">
<td align="left">ABC-1002</td>
<td align="left">HEADACHE</td>
<td align="left">VACCINATION 1</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
</tr>
<tr class="even">
<td align="left">ABC-1002</td>
<td align="left">HEADACHE</td>
<td align="left">VACCINATION 2</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="odd">
<td align="left">ABC-1002</td>
<td align="left">PAIN AT INJECTION SITE</td>
<td align="left">VACCINATION 2</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
<tr class="even">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="left">MAXSEV</td>
<td align="left">Maximum Severity</td>
<td align="right">1</td>
<td align="left">MILD</td>
</tr>
</tbody>
</table>
<p>This call returns the input dataset with maximum records added for the severity, diameter, temperature.</p>
</div>
<div id="paramcd" class="section level2">
<h2>Assign <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code>, <code>PARCAT1</code></h2>
<p>To assign parameter level values such as <code>PARAMCD</code>, <code>PARAM</code>, <code>PARAMN</code>, etc., a lookup needs to be created to join to the source data. <code>PARCAT1</code>, <code>PARCAT2</code> variables are assigned from <code>FACAT</code>, <code>FASCAT</code> variables.</p>
<p>For example, when creating <code>ADFACE</code> dataset, a lookup based on the SDTM <code>--TESTCD</code> value can be created:</p>
<table>
<thead>
<tr class="header">
<th><code>FATESTCD</code></th>
<th><code>PARAMCD</code></th>
<th><code>PARAMN</code></th>
<th><code>FATEST</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SEV</td>
<td>SEVREDN</td>
<td>1</td>
<td>Severity</td>
</tr>
<tr class="even">
<td>DIAMETER</td>
<td>DIARE</td>
<td>2</td>
<td>Diameter</td>
</tr>
<tr class="odd">
<td>MAXDIAM</td>
<td>MDIRE</td>
<td>3</td>
<td>Maximum Diameter cm</td>
</tr>
<tr class="even">
<td>MAXTEMP</td>
<td>MAXTEMP</td>
<td>4</td>
<td>Maximum Temperature</td>
</tr>
<tr class="odd">
<td>MAXSEV</td>
<td>MAXSWEL</td>
<td>5</td>
<td>Maximum Severity</td>
</tr>
<tr class="even">
<td>OCCUR</td>
<td>OCFEVER</td>
<td>6</td>
<td>Occurrence Indicator</td>
</tr>
<tr class="odd">
<td>OCCUR</td>
<td>OCERYTH</td>
<td>7</td>
<td>Occurrence Indicator</td>
</tr>
<tr class="even">
<td>SEV</td>
<td>SEVPAIN</td>
<td>8</td>
<td>Severity</td>
</tr>
<tr class="odd">
<td>OCCUR</td>
<td>OCPAIN</td>
<td>9</td>
<td>Occurrence Indicator</td>
</tr>
<tr class="even">
<td>OCCUR</td>
<td>OCSWEL</td>
<td>10</td>
<td>Occurrence Indicator</td>
</tr>
</tbody>
</table>
<p>This lookup can now be joined to the source data:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">adface &lt;-<span class="st"> </span><span class="kw">derive_vars_params</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">lookup_dataset =</span> lookup_dataset,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  <span class="dt">merge_vars =</span> <span class="kw">exprs</span>(PARAMCD, PARAMN)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">)</a></code></pre></div>
<table>
<colgroup>
<col width="6%"></col>
<col width="6%"></col>
<col width="9%"></col>
<col width="12%"></col>
<col width="5%"></col>
<col width="32%"></col>
<col width="4%"></col>
<col width="10%"></col>
<col width="13%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="left">ATPTREF</th>
<th align="left">FATEST</th>
<th align="left">PARAMCD</th>
<th align="left">PARAM</th>
<th align="right">PARAMN</th>
<th align="left">PARCAT1</th>
<th align="left">PARCAT2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVREDN</td>
<td align="left">Redness severity/intensity deltoid muscle left</td>
<td align="right">1</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVSWEL</td>
<td align="left">Swelling severity/intensity deltoid muscle left</td>
<td align="right">22</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVSWEL</td>
<td align="left">Swelling severity/intensity deltoid muscle left</td>
<td align="right">22</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVSWEL</td>
<td align="left">Swelling severity/intensity deltoid muscle left</td>
<td align="right">22</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVSWEL</td>
<td align="left">Swelling severity/intensity deltoid muscle left</td>
<td align="right">22</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVSWEL</td>
<td align="left">Swelling severity/intensity deltoid muscle left</td>
<td align="right">22</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVSWEL</td>
<td align="left">Swelling severity/intensity deltoid muscle left</td>
<td align="right">22</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVSWEL</td>
<td align="left">Swelling severity/intensity deltoid muscle left</td>
<td align="right">22</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="odd">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVREDN</td>
<td align="left">Redness severity/intensity deltoid muscle left</td>
<td align="right">1</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
<tr class="even">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 2</td>
<td align="left">Severity/Intensity</td>
<td align="left">SEVREDN</td>
<td align="left">Redness severity/intensity deltoid muscle left</td>
<td align="right">1</td>
<td align="left">REACTOGENICITY</td>
<td align="left">ADMINISTRATION SITE</td>
</tr>
</tbody>
</table>
<p><code>PARAMCD</code> will be always derived from lookup dataset whereas <code>PARAMN</code>, <code>PARAM</code>, <code>PARCAT1</code>, <code>PARCAT2</code> can be either derived from lookup dataset if mentioned in <code>merge_vars</code> argument or derived in the function.</p>
</div>
<div id="maxflag" class="section level2">
<h2>Derive Maximum Severity Flag</h2>
<p>The function <code>derive_vars_max_flag()</code> is used to derive flag variable for the maximum values of an event.</p>
<p><code>flag1</code> - Flags the maximum value per subject per event per Vaccination. <code>flag2</code> - Flags the maximum value per subject per event for Overall.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">adface &lt;-<span class="st"> </span><span class="kw">derive_vars_max_flag</span>(</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="dt">flag1 =</span> <span class="st">&quot;ANL01FL&quot;</span>,</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  <span class="dt">flag2 =</span> <span class="st">&quot;ANL02FL&quot;</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt; Joining, by = c(&quot;STUDYID&quot;, &quot;DOMAIN&quot;, &quot;USUBJID&quot;, &quot;FASEQ&quot;, &quot;FALNKGRP&quot;, &quot;PARAM&quot;, &quot;FALAT&quot;, &quot;FALNKID&quot;, &quot;FALOC&quot;, &quot;FATESTCD&quot;, &quot;FATEST&quot;, &quot;FAOBJ&quot;, &quot;FACAT&quot;, &quot;FASCAT&quot;, &quot;FAEVAL&quot;, &quot;FAORRES&quot;, &quot;FAORRESU&quot;, &quot;EPOCH&quot;, &quot;FADTC&quot;, &quot;FADY&quot;, &quot;FATPT&quot;, &quot;FATPTNUM&quot;, &quot;FATPTREF&quot;, &quot;FARFTDTC&quot;, &quot;FAEVLINT&quot;, &quot;FAEVINTX&quot;, &quot;FASTAT&quot;, &quot;FAREASND&quot;, &quot;FASTRESC&quot;, &quot;FASTRESN&quot;, &quot;FASTRESU&quot;, &quot;RFSTDTC&quot;, &quot;RFENDTC&quot;, &quot;VSSTRESN&quot;, &quot;ADT&quot;, &quot;ADTM&quot;, &quot;ADY&quot;, &quot;APERIOD&quot;, &quot;APERSDT&quot;, &quot;APEREDT&quot;, &quot;TRTA&quot;, &quot;TRTP&quot;, &quot;AVALC&quot;, &quot;AVAL&quot;, &quot;ATPTREF&quot;, &quot;ATPT&quot;, &quot;ATPTN&quot;, &quot;PARAMCD&quot;, &quot;PARAMN&quot;, &quot;PARCAT1&quot;, &quot;PARCAT2&quot;)</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; Joining, by = c(&quot;STUDYID&quot;, &quot;DOMAIN&quot;, &quot;USUBJID&quot;, &quot;FASEQ&quot;, &quot;FALNKGRP&quot;, &quot;PARAM&quot;, &quot;FALAT&quot;, &quot;FALNKID&quot;, &quot;FALOC&quot;, &quot;FATESTCD&quot;, &quot;FATEST&quot;, &quot;FAOBJ&quot;, &quot;FACAT&quot;, &quot;FASCAT&quot;, &quot;FAEVAL&quot;, &quot;FAORRES&quot;, &quot;FAORRESU&quot;, &quot;EPOCH&quot;, &quot;FADTC&quot;, &quot;FADY&quot;, &quot;FATPT&quot;, &quot;FATPTNUM&quot;, &quot;FATPTREF&quot;, &quot;FARFTDTC&quot;, &quot;FAEVLINT&quot;, &quot;FAEVINTX&quot;, &quot;FASTAT&quot;, &quot;FAREASND&quot;, &quot;FASTRESC&quot;, &quot;FASTRESN&quot;, &quot;FASTRESU&quot;, &quot;RFSTDTC&quot;, &quot;RFENDTC&quot;, &quot;VSSTRESN&quot;, &quot;ADT&quot;, &quot;ADTM&quot;, &quot;ADY&quot;, &quot;APERIOD&quot;, &quot;APERSDT&quot;, &quot;APEREDT&quot;, &quot;TRTA&quot;, &quot;TRTP&quot;, &quot;AVALC&quot;, &quot;AVAL&quot;, &quot;ATPTREF&quot;, &quot;ATPT&quot;, &quot;ATPTN&quot;, &quot;PARAMCD&quot;, &quot;PARAMN&quot;, &quot;PARCAT1&quot;, &quot;PARCAT2&quot;, &quot;ANL01FL&quot;)</span></a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="left">ATPTREF</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
<th align="left">ANL01FL</th>
<th align="left">ANL02FL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">0</td>
<td align="left">NONE</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">0</td>
<td align="left">NONE</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">Y</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 2</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
<p>This call would return the input dataset with columns <code>ANL01FL</code>, <code>ANL02FL</code> added by default. This function allows the user to change the name of the new variables created.</p>
</div>
<div id="eventflag" class="section level2">
<h2>Derive Event Occurrence Flag</h2>
<p>The function <code>derive_vars_event_flag()</code> is used to derive flag variable for the events that occurred.</p>
<p><code>new_var1</code> - Flags the record if at least one of the event occurred within the observation period. <code>new_var2</code> - Flags the record if the event is occurred.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">adface &lt;-<span class="st"> </span><span class="kw">derive_vars_event_flag</span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="dt">by_vars =</span> <span class="kw">exprs</span>(USUBJID, FAOBJ, ATPTREF),</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="dt">aval_cutoff =</span> <span class="fl">2.5</span>,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">  <span class="dt">new_var1 =</span> EVENTFL,</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">  <span class="dt">new_var2 =</span> EVENTDFL</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">FAOBJ</th>
<th align="left">ATPTREF</th>
<th align="right">AVAL</th>
<th align="left">AVALC</th>
<th align="left">EVENTFL</th>
<th align="left">EVENTDFL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">0</td>
<td align="left">NONE</td>
<td align="left">Y</td>
<td align="left">N</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">2</td>
<td align="left">MODERATE</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">SWELLING</td>
<td align="left">VACCINATION 1</td>
<td align="right">0</td>
<td align="left">NONE</td>
<td align="left">Y</td>
<td align="left">N</td>
</tr>
<tr class="odd">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 1</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
<tr class="even">
<td align="left">ABC-1002</td>
<td align="left">REDNESS</td>
<td align="left">VACCINATION 2</td>
<td align="right">1</td>
<td align="left">MILD</td>
<td align="left">Y</td>
<td align="left">Y</td>
</tr>
</tbody>
</table>
<p>This call would return the input dataset with columns <code>EVENTFL</code>, <code>EVENTDFL</code> added by default. This function allows the user to change the name of the new variables created as well.</p>
</div>
<div id="post" class="section level2">
<h2>Post-processing of the Dataset</h2>
<p>In this step, we will remove values for all the derived records in SDTM variables.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">adface &lt;-<span class="st"> </span><span class="kw">post_process_reacto</span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="dt">filter_dataset =</span> FATESTCD <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MAXDIAM&quot;</span>, <span class="st">&quot;MAXSEV&quot;</span>, <span class="st">&quot;MAXTEMP&quot;</span>) <span class="op">|</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="st">    </span>(FATESTCD <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OCCUR&quot;</span>, <span class="st">&quot;SEV&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>FAOBJ <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;FEVER&quot;</span>, <span class="st">&quot;REDNESS&quot;</span>, <span class="st">&quot;SWELLING&quot;</span>))</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">)</a></code></pre></div>
</div>
<div id="adsl_vars" class="section level2">
<h2>Add ADSL variables</h2>
<p>If needed, the other <code>ADSL</code> variables can now be added. List of ADSL variables already merged held in vector <code>adsl_vars</code></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">adsl &lt;-<span class="st"> </span>adsl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw">convert_blanks_to_na</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(USUBJID))</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">adface &lt;-<span class="st"> </span><span class="kw">derive_vars_merged</span>(</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  <span class="dt">dataset =</span> adface,</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">  <span class="dt">dataset_add =</span> <span class="kw">select</span>(adsl, <span class="op">!!!</span><span class="kw">negate_vars</span>(adsl_vars)),</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">  <span class="dt">by_vars =</span> <span class="kw">exprs</span>(STUDYID, USUBJID)</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">TRTSDT</th>
<th align="left">TRTEDT</th>
<th align="right">AGE</th>
<th align="left">SEX</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-30</td>
<td align="right">74</td>
<td align="left">F</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-30</td>
<td align="right">74</td>
<td align="left">F</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-30</td>
<td align="right">74</td>
<td align="left">F</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-30</td>
<td align="right">74</td>
<td align="left">F</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-30</td>
<td align="right">74</td>
<td align="left">F</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-30</td>
<td align="right">74</td>
<td align="left">F</td>
</tr>
<tr class="odd">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-30</td>
<td align="right">74</td>
<td align="left">F</td>
</tr>
<tr class="even">
<td align="left">ABC-1001</td>
<td align="left">2021-11-03</td>
<td align="left">2021-12-30</td>
<td align="right">74</td>
<td align="left">F</td>
</tr>
<tr class="odd">
<td align="left">ABC-1002</td>
<td align="left">2021-10-07</td>
<td align="left">2021-12-16</td>
<td align="right">70</td>
<td align="left">F</td>
</tr>
<tr class="even">
<td align="left">ABC-1002</td>
<td align="left">2021-10-07</td>
<td align="left">2021-12-16</td>
<td align="right">70</td>
<td align="left">F</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="example-script" class="section level1">
<h1>Example Script</h1>
<table>
<thead>
<tr class="header">
<th>ADaM</th>
<th>Sample Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ADFACE</td>
<td><a href="https://github.com/pharmaverse/admiralvaccine/blob/main/inst/templates/ad_adface.R" target="_blank">ad_adface.R</a></td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
